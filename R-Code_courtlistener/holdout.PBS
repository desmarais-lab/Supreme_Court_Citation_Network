#PBS -l nodes=1:ppn=1
#PBS -l walltime=70:00:00
#PBS -m abe
#PBS -M schmid@psu.edu
#PBS -l mem=128GB
#PBS -j oe


cd /storage/work/cxs5700/SCC_paper/MPLE_cl

echo " "
echo " "
echo "Job started on `hostname` at `date`"

module load R/3.2.0

R --vanilla <<STOP > holdout.out

# read in data
scdata <- read.csv("mpledata_all.csv",stringsAsFactors=F)

library(MLmetrics)
library(xtable)


################################
# no trend


set.seed(123)

niter = 10
predict.results <- matrix(0,niter,6)

for(i in 1:niter){

train.obs <- sample(1:nrow(scdata),round(0.8*nrow(scdata)))

train.data <- scdata[train.obs,]

#library(biglm)

# MPLE
mple.est <- glm(edgeij ~ istar2+ostar2+mutual+triangle+ edgecov.mq.t+ edgecov.same.issue.area.t+ edgecov.year.diff.t +edgecov.year.diff.square.t +  
                nodeicov.AbsDiffMQscores+ nodeicov.NumberJusticesPro + nodeifactor.SameIssueArea.2+ nodeifactor.SameIssueArea.3+ 
                nodeifactor.SameIssueArea.4+nodeifactor.SameIssueArea.5+ nodeifactor.SameIssueArea.6+ nodeifactor.SameIssueArea.7+ 
                nodeifactor.SameIssueArea.8+nodeifactor.SameIssueArea.9+  nodeifactor.SameIssueArea.10+
                nodeifactor.SameIssueArea.11+ nodeifactor.SameIssueArea.12+ nodeifactor.SameIssueArea.13+nodeifactor.SameIssueArea.14+ 
                nodeofactor.SameIssueArea.2+ nodeofactor.SameIssueArea.3+ nodeofactor.SameIssueArea.4+nodeofactor.SameIssueArea.5+ 
                nodeofactor.SameIssueArea.6+nodeofactor.SameIssueArea.7+
                nodeofactor.SameIssueArea.8+nodeofactor.SameIssueArea.9+nodeofactor.SameIssueArea.10+ nodeofactor.SameIssueArea.11+ 
                nodeofactor.SameIssueArea.12+ nodeofactor.SameIssueArea.13+nodeofactor.SameIssueArea.14+ nodeicov.Overruled ,family=binomial,data=train.data)
summary(mple.est)

save(list="mple.est",file="training_full_0.RData")


# MPLE
mple.est.independent <- glm(edgeij ~ edgecov.mq.t+ edgecov.same.issue.area.t+ edgecov.year.diff.t +edgecov.year.diff.square.t +  
                nodeicov.AbsDiffMQscores+ nodeicov.NumberJusticesPro + nodeifactor.SameIssueArea.2+ nodeifactor.SameIssueArea.3+ 
                nodeifactor.SameIssueArea.4+nodeifactor.SameIssueArea.5+ nodeifactor.SameIssueArea.6+ nodeifactor.SameIssueArea.7+ 
                nodeifactor.SameIssueArea.8+nodeifactor.SameIssueArea.9+  nodeifactor.SameIssueArea.10+
                nodeifactor.SameIssueArea.11+ nodeifactor.SameIssueArea.12+ nodeifactor.SameIssueArea.13+nodeifactor.SameIssueArea.14+ 
                nodeofactor.SameIssueArea.2+ nodeofactor.SameIssueArea.3+ nodeofactor.SameIssueArea.4+nodeofactor.SameIssueArea.5+ 
                nodeofactor.SameIssueArea.6+nodeofactor.SameIssueArea.7+
                nodeofactor.SameIssueArea.8+nodeofactor.SameIssueArea.9+nodeofactor.SameIssueArea.10+ nodeofactor.SameIssueArea.11+ 
                nodeofactor.SameIssueArea.12+ nodeofactor.SameIssueArea.13+nodeofactor.SameIssueArea.14+ nodeicov.Overruled ,family=binomial,train.data)
summary(mple.est.independent)

save(list="mple.est.independent",file="training_independent_0.RData")

test.data <- scdata[-train.obs,]

predict.full <- c(predict(mple.est,newdata=test.data,type="response"))

predict.independent <- c(predict(mple.est.independent,newdata=test.data,type="response"))


print(names(test.data)[1:3])
true.y <- test.data[,2]
pred.full <- as.numeric(predict.full>0.5)
pred.ind <- as.numeric(predict.independent>0.5)

precision <- function(true.y,pred.y){
  mean(true.y[which(pred.y==1)])
}

recall <- function(true.y,pred.y){
  mean(pred.y[which(true.y==1)])
}

prec.full <- precision(true.y,pred.full)
prec.ind <- precision(true.y,pred.ind)

rec.full <- recall(true.y,pred.full)
rec.ind <- recall(true.y,pred.ind)

f1.full <- F1_Score(true.y,pred.full,pos=1)
f1.ind  <- F1_Score(true.y,pred.ind,pos=1)

predict.results[i,] <- c(prec.full,prec.ind,rec.full,rec.ind,f1.full,f1.ind)

print(i)

}

save(list="predict.results",file="prediction.performance_0.RData")

mean.range <- function(x){
  c(round(mean(x),dig=4),paste("(",round(min(x),dig=4),", ",round(max(x),dig=4),")",sep=""))
}

results.full <- t(apply(predict.results[,c(1,3,5)],2,mean.range))
results.ind <- t(apply(predict.results[,c(2,4,6)],2,mean.range))



results.table <- cbind(results.ind,results.full)

rownames(results.table) <- c("precision","recall","F1 score")

colnames(results.table) <- c("mean","range","mean","range")

tex.table <- xtable(results.table)

print(tex.table,file="prediction_table_notrend.tex")





################################
# linear trend


set.seed(123)

niter = 10
predict.results <- matrix(0,niter,6)

for(i in 1:niter){

train.obs <- sample(1:nrow(scdata),round(0.8*nrow(scdata)))

train.data <- scdata[train.obs,]

#library(biglm)

# MPLE
mple.est <- glm(edgeij ~ istar2+ostar2+mutual+triangle+ edgecov.mq.t+ edgecov.same.issue.area.t+ edgecov.year.diff.t +edgecov.year.diff.square.t +  
                nodeicov.AbsDiffMQscores+ nodeicov.NumberJusticesPro+ edgecov.year.t + nodeifactor.SameIssueArea.2+ nodeifactor.SameIssueArea.3+ 
                nodeifactor.SameIssueArea.4+nodeifactor.SameIssueArea.5+ nodeifactor.SameIssueArea.6+ nodeifactor.SameIssueArea.7+ 
                nodeifactor.SameIssueArea.8+nodeifactor.SameIssueArea.9+  nodeifactor.SameIssueArea.10+
                nodeifactor.SameIssueArea.11+ nodeifactor.SameIssueArea.12+ nodeifactor.SameIssueArea.13+nodeifactor.SameIssueArea.14+ 
                nodeofactor.SameIssueArea.2+ nodeofactor.SameIssueArea.3+ nodeofactor.SameIssueArea.4+nodeofactor.SameIssueArea.5+ 
                nodeofactor.SameIssueArea.6+nodeofactor.SameIssueArea.7+
                nodeofactor.SameIssueArea.8+nodeofactor.SameIssueArea.9+nodeofactor.SameIssueArea.10+ nodeofactor.SameIssueArea.11+ 
                nodeofactor.SameIssueArea.12+ nodeofactor.SameIssueArea.13+nodeofactor.SameIssueArea.14+ nodeicov.Overruled +
                instar2_sendertime+outstar2_sendertime+ mutual_sendertime+ triangle_sendertime+mq_sendertime +sameissuearea_sendertime+
                yeardiff_sendertime + yeardiffsquare_sendertime+ AbsDiffMQscores_sendertime + NumberJusticesPro_sendertime + Overruled_sendertime ,family=binomial,data=train.data)
summary(mple.est)

save(list="mple.est",file="training_full_1.RData")


# MPLE
mple.est.independent <- glm(edgeij ~ edgecov.mq.t+ edgecov.same.issue.area.t+ edgecov.year.diff.t +edgecov.year.diff.square.t +  
                nodeicov.AbsDiffMQscores+ nodeicov.NumberJusticesPro+ edgecov.year.t + nodeifactor.SameIssueArea.2+ nodeifactor.SameIssueArea.3+ 
                nodeifactor.SameIssueArea.4+nodeifactor.SameIssueArea.5+ nodeifactor.SameIssueArea.6+ nodeifactor.SameIssueArea.7+ 
                nodeifactor.SameIssueArea.8+nodeifactor.SameIssueArea.9+  nodeifactor.SameIssueArea.10+
                nodeifactor.SameIssueArea.11+ nodeifactor.SameIssueArea.12+ nodeifactor.SameIssueArea.13+nodeifactor.SameIssueArea.14+ 
                nodeofactor.SameIssueArea.2+ nodeofactor.SameIssueArea.3+ nodeofactor.SameIssueArea.4+nodeofactor.SameIssueArea.5+ 
                nodeofactor.SameIssueArea.6+nodeofactor.SameIssueArea.7+
                nodeofactor.SameIssueArea.8+nodeofactor.SameIssueArea.9+nodeofactor.SameIssueArea.10+ nodeofactor.SameIssueArea.11+ 
                nodeofactor.SameIssueArea.12+ nodeofactor.SameIssueArea.13+nodeofactor.SameIssueArea.14+ nodeicov.Overruled +
                mq_sendertime +sameissuearea_sendertime+
                yeardiff_sendertime + yeardiffsquare_sendertime+ AbsDiffMQscores_sendertime + NumberJusticesPro_sendertime  + Overruled_sendertime ,family=binomial,train.data)
summary(mple.est.independent)

save(list="mple.est.independent",file="training_independent_1.RData")

test.data <- scdata[-train.obs,]

predict.full <- c(predict(mple.est,newdata=test.data,type="response"))

predict.independent <- c(predict(mple.est.independent,newdata=test.data,type="response"))


print(names(test.data)[1:3])
true.y <- test.data[,2]
pred.full <- as.numeric(predict.full>0.5)
pred.ind <- as.numeric(predict.independent>0.5)

precision <- function(true.y,pred.y){
  mean(true.y[which(pred.y==1)])
}

recall <- function(true.y,pred.y){
  mean(pred.y[which(true.y==1)])
}

prec.full <- precision(true.y,pred.full)
prec.ind <- precision(true.y,pred.ind)

rec.full <- recall(true.y,pred.full)
rec.ind <- recall(true.y,pred.ind)

f1.full <- F1_Score(true.y,pred.full,pos=1)
f1.ind  <- F1_Score(true.y,pred.ind,pos=1)

predict.results[i,] <- c(prec.full,prec.ind,rec.full,rec.ind,f1.full,f1.ind)

print(i)

}

save(list="predict.results",file="prediction.performance_1.RData")

mean.range <- function(x){
  c(round(mean(x),dig=4),paste("(",round(min(x),dig=4),", ",round(max(x),dig=4),")",sep=""))
}

results.full <- t(apply(predict.results[,c(1,3,5)],2,mean.range))
results.ind <- t(apply(predict.results[,c(2,4,6)],2,mean.range))



results.table <- cbind(results.ind,results.full)

rownames(results.table) <- c("precision","recall","F1 score")

colnames(results.table) <- c("mean","range","mean","range")

tex.table <- xtable(results.table)

print(tex.table,file="prediction_table_linear.tex")



##########################################################
## quadratic trend


niter = 10
predict.results <- matrix(0,niter,6)

for(i in 1:niter){
  
  train.obs <- sample(1:nrow(scdata),round(0.8*nrow(scdata)))
  
  train.data <- scdata[train.obs,]
  
  #library(biglm)
  
  # MPLE
  mple.est <- glm(edgeij ~ istar2+ostar2+mutual+triangle+ edgecov.mq.t+ edgecov.same.issue.area.t+ edgecov.year.diff.t +edgecov.year.diff.square.t +  
                    nodeicov.AbsDiffMQscores+ nodeicov.NumberJusticesPro+ edgecov.year.t + nodeifactor.SameIssueArea.2+ nodeifactor.SameIssueArea.3+ 
                    nodeifactor.SameIssueArea.4+nodeifactor.SameIssueArea.5+ nodeifactor.SameIssueArea.6+ nodeifactor.SameIssueArea.7+ 
                    nodeifactor.SameIssueArea.8+nodeifactor.SameIssueArea.9+  nodeifactor.SameIssueArea.10+
                    nodeifactor.SameIssueArea.11+ nodeifactor.SameIssueArea.12+ nodeifactor.SameIssueArea.13+nodeifactor.SameIssueArea.14+ 
                    nodeofactor.SameIssueArea.2+ nodeofactor.SameIssueArea.3+ nodeofactor.SameIssueArea.4+nodeofactor.SameIssueArea.5+ 
                    nodeofactor.SameIssueArea.6+nodeofactor.SameIssueArea.7+
                    nodeofactor.SameIssueArea.8+nodeofactor.SameIssueArea.9+nodeofactor.SameIssueArea.10+ nodeofactor.SameIssueArea.11+ 
                    nodeofactor.SameIssueArea.12+ nodeofactor.SameIssueArea.13+nodeofactor.SameIssueArea.14+ nodeicov.Overruled +
                    instar2_sendertime+outstar2_sendertime+ mutual_sendertime+ triangle_sendertime+mq_sendertime +sameissuearea_sendertime+
                    yeardiff_sendertime + yeardiffsquare_sendertime+ AbsDiffMQscores_sendertime + NumberJusticesPro_sendertime + Overruled_sendertime +
                    instar2_sendertime2+outstar2_sendertime2+ mutual_sendertime2+ triangle_sendertime2+mq_sendertime2 +sameissuearea_sendertime2+
                    yeardiff_sendertime2 + yeardiffsquare_sendertime2+ AbsDiffMQscores_sendertime2 + NumberJusticesPro_sendertime2+ Overruled_sendertime2 +
                    edgecov.year.t2 ,family=binomial,data=train.data)
  summary(mple.est)
  
  save(list="mple.est",file="training_full_2.RData")
  
  
  # MPLE
  mple.est.independent <- glm(edgeij ~ edgecov.mq.t+ edgecov.same.issue.area.t+ edgecov.year.diff.t +edgecov.year.diff.square.t +  
                                nodeicov.AbsDiffMQscores+ nodeicov.NumberJusticesPro+ edgecov.year.t + nodeifactor.SameIssueArea.2+ nodeifactor.SameIssueArea.3+ 
                                nodeifactor.SameIssueArea.4+nodeifactor.SameIssueArea.5+ nodeifactor.SameIssueArea.6+ nodeifactor.SameIssueArea.7+ 
                                nodeifactor.SameIssueArea.8+nodeifactor.SameIssueArea.9+  nodeifactor.SameIssueArea.10+
                                nodeifactor.SameIssueArea.11+ nodeifactor.SameIssueArea.12+ nodeifactor.SameIssueArea.13+nodeifactor.SameIssueArea.14+ 
                                nodeofactor.SameIssueArea.2+ nodeofactor.SameIssueArea.3+ nodeofactor.SameIssueArea.4+nodeofactor.SameIssueArea.5+ 
                                nodeofactor.SameIssueArea.6+nodeofactor.SameIssueArea.7+
                                nodeofactor.SameIssueArea.8+nodeofactor.SameIssueArea.9+nodeofactor.SameIssueArea.10+ nodeofactor.SameIssueArea.11+ 
                                nodeofactor.SameIssueArea.12+ nodeofactor.SameIssueArea.13+nodeofactor.SameIssueArea.14+ nodeicov.Overruled +
                                mq_sendertime +sameissuearea_sendertime+
                                yeardiff_sendertime + yeardiffsquare_sendertime+ AbsDiffMQscores_sendertime + NumberJusticesPro_sendertime  + Overruled_sendertime +
                                mq_sendertime2 +sameissuearea_sendertime2+
                                yeardiff_sendertime2 + yeardiffsquare_sendertime2+ AbsDiffMQscores_sendertime2 + NumberJusticesPro_sendertime2+ Overruled_sendertime2 +
                                edgecov.year.t2 ,family=binomial,train.data)
  summary(mple.est.independent)
  
  save(list="mple.est.independent",file="training_independent_2.RData")
  
  test.data <- scdata[-train.obs,]
  
  predict.full <- c(predict(mple.est,newdata=test.data,type="response"))
  
  predict.independent <- c(predict(mple.est.independent,newdata=test.data,type="response"))
  
  
  print(names(test.data)[1:3])
  true.y <- test.data[,2]
  pred.full <- as.numeric(predict.full>0.5)
  pred.ind <- as.numeric(predict.independent>0.5)
  
  precision <- function(true.y,pred.y){
    mean(true.y[which(pred.y==1)])
  }
  
  recall <- function(true.y,pred.y){
    mean(pred.y[which(true.y==1)])
  }
  
  prec.full <- precision(true.y,pred.full)
  prec.ind <- precision(true.y,pred.ind)
  
  rec.full <- recall(true.y,pred.full)
  rec.ind <- recall(true.y,pred.ind)
  
  f1.full <- F1_Score(true.y,pred.full,pos=1)
  f1.ind  <- F1_Score(true.y,pred.ind,pos=1)
  
  predict.results[i,] <- c(prec.full,prec.ind,rec.full,rec.ind,f1.full,f1.ind)
  
  print(i)
  
}

save(list="predict.results",file="prediction.performance_2.RData")

mean.range <- function(x){
  c(round(mean(x),dig=4),paste("(",round(min(x),dig=4),", ",round(max(x),dig=4),")",sep=""))
}

results.full <- t(apply(predict.results[,c(1,3,5)],2,mean.range))
results.ind <- t(apply(predict.results[,c(2,4,6)],2,mean.range))



results.table <- cbind(results.ind,results.full)

rownames(results.table) <- c("precision","recall","F1 score")

colnames(results.table) <- c("mean","range","mean","range")

tex.table <- xtable(results.table)

print(tex.table,file="prediction_table_quadratic.tex")



##############################################################
## cubic trend


niter = 10
predict.results <- matrix(0,niter,6)

for(i in 1:niter){
  
  train.obs <- sample(1:nrow(scdata),round(0.8*nrow(scdata)))
  
  train.data <- scdata[train.obs,]
  
  #library(biglm)
  
  # MPLE
  mple.est <- glm(edgeij ~ istar2+ostar2+mutual+triangle+ edgecov.mq.t+ edgecov.same.issue.area.t+ edgecov.year.diff.t +edgecov.year.diff.square.t +  
                    nodeicov.AbsDiffMQscores+ nodeicov.NumberJusticesPro+ edgecov.year.t + nodeifactor.SameIssueArea.2+ nodeifactor.SameIssueArea.3+ 
                    nodeifactor.SameIssueArea.4+nodeifactor.SameIssueArea.5+ nodeifactor.SameIssueArea.6+ nodeifactor.SameIssueArea.7+ 
                    nodeifactor.SameIssueArea.8+nodeifactor.SameIssueArea.9+  nodeifactor.SameIssueArea.10+
                    nodeifactor.SameIssueArea.11+ nodeifactor.SameIssueArea.12+ nodeifactor.SameIssueArea.13+nodeifactor.SameIssueArea.14+ 
                    nodeofactor.SameIssueArea.2+ nodeofactor.SameIssueArea.3+ nodeofactor.SameIssueArea.4+nodeofactor.SameIssueArea.5+ 
                    nodeofactor.SameIssueArea.6+nodeofactor.SameIssueArea.7+
                    nodeofactor.SameIssueArea.8+nodeofactor.SameIssueArea.9+nodeofactor.SameIssueArea.10+ nodeofactor.SameIssueArea.11+ 
                    nodeofactor.SameIssueArea.12+ nodeofactor.SameIssueArea.13+nodeofactor.SameIssueArea.14+ nodeicov.Overruled +
                    instar2_sendertime+outstar2_sendertime+ mutual_sendertime+ triangle_sendertime+mq_sendertime +sameissuearea_sendertime+
                    yeardiff_sendertime + yeardiffsquare_sendertime+ AbsDiffMQscores_sendertime + NumberJusticesPro_sendertime + Overruled_sendertime +
                    instar2_sendertime2+outstar2_sendertime2+ mutual_sendertime2+ triangle_sendertime2+mq_sendertime2 +sameissuearea_sendertime2+
                    yeardiff_sendertime2 + yeardiffsquare_sendertime2+ AbsDiffMQscores_sendertime2 + NumberJusticesPro_sendertime2+ Overruled_sendertime2 +
                    instar2_sendertime3+outstar2_sendertime3+ mutual_sendertime3+ triangle_sendertime3+mq_sendertime3 +sameissuearea_sendertime3+
                    yeardiff_sendertime3 + yeardiffsquare_sendertime3+ AbsDiffMQscores_sendertime3 + NumberJusticesPro_sendertime3+ Overruled_sendertime3 +
                    edgecov.year.t2 + edgecov.year.t3 ,family=binomial,data=train.data)
  summary(mple.est)
  
  save(list="mple.est",file="training_full_3.RData")
  
  
  # MPLE
  mple.est.independent <- glm(edgeij ~ edgecov.mq.t+ edgecov.same.issue.area.t+ edgecov.year.diff.t +edgecov.year.diff.square.t +  
                                nodeicov.AbsDiffMQscores+ nodeicov.NumberJusticesPro+ edgecov.year.t + nodeifactor.SameIssueArea.2+ nodeifactor.SameIssueArea.3+ 
                                nodeifactor.SameIssueArea.4+nodeifactor.SameIssueArea.5+ nodeifactor.SameIssueArea.6+ nodeifactor.SameIssueArea.7+ 
                                nodeifactor.SameIssueArea.8+nodeifactor.SameIssueArea.9+  nodeifactor.SameIssueArea.10+
                                nodeifactor.SameIssueArea.11+ nodeifactor.SameIssueArea.12+ nodeifactor.SameIssueArea.13+nodeifactor.SameIssueArea.14+ 
                                nodeofactor.SameIssueArea.2+ nodeofactor.SameIssueArea.3+ nodeofactor.SameIssueArea.4+nodeofactor.SameIssueArea.5+ 
                                nodeofactor.SameIssueArea.6+nodeofactor.SameIssueArea.7+
                                nodeofactor.SameIssueArea.8+nodeofactor.SameIssueArea.9+nodeofactor.SameIssueArea.10+ nodeofactor.SameIssueArea.11+ 
                                nodeofactor.SameIssueArea.12+ nodeofactor.SameIssueArea.13+nodeofactor.SameIssueArea.14+ nodeicov.Overruled +
                                mq_sendertime +sameissuearea_sendertime+
                                yeardiff_sendertime + yeardiffsquare_sendertime+ AbsDiffMQscores_sendertime + NumberJusticesPro_sendertime  + Overruled_sendertime +
                                mq_sendertime2 +sameissuearea_sendertime2+
                                yeardiff_sendertime2 + yeardiffsquare_sendertime2+ AbsDiffMQscores_sendertime2 + NumberJusticesPro_sendertime2+ Overruled_sendertime2 +
                                mq_sendertime3 +sameissuearea_sendertime3+
                                yeardiff_sendertime3 + yeardiffsquare_sendertime3+ AbsDiffMQscores_sendertime3 + NumberJusticesPro_sendertime3 + Overruled_sendertime3 +
                                edgecov.year.t2 + edgecov.year.t3 ,family=binomial,train.data)
  summary(mple.est.independent)
  
  save(list="mple.est.independent",file="training_independent_3.RData")
  
  test.data <- scdata[-train.obs,]
  
  predict.full <- c(predict(mple.est,newdata=test.data,type="response"))
  
  predict.independent <- c(predict(mple.est.independent,newdata=test.data,type="response"))
  
  
  print(names(test.data)[1:3])
  true.y <- test.data[,2]
  pred.full <- as.numeric(predict.full>0.5)
  pred.ind <- as.numeric(predict.independent>0.5)
  
  precision <- function(true.y,pred.y){
    mean(true.y[which(pred.y==1)])
  }
  
  recall <- function(true.y,pred.y){
    mean(pred.y[which(true.y==1)])
  }
  
  prec.full <- precision(true.y,pred.full)
  prec.ind <- precision(true.y,pred.ind)
  
  rec.full <- recall(true.y,pred.full)
  rec.ind <- recall(true.y,pred.ind)
  
  f1.full <- F1_Score(true.y,pred.full,pos=1)
  f1.ind  <- F1_Score(true.y,pred.ind,pos=1)
  
  predict.results[i,] <- c(prec.full,prec.ind,rec.full,rec.ind,f1.full,f1.ind)
  
  print(i)
  
}

save(list="predict.results",file="prediction.performance_3.RData")

mean.range <- function(x){
  c(round(mean(x),dig=4),paste("(",round(min(x),dig=4),", ",round(max(x),dig=4),")",sep=""))
}

results.full <- t(apply(predict.results[,c(1,3,5)],2,mean.range))
results.ind <- t(apply(predict.results[,c(2,4,6)],2,mean.range))



results.table <- cbind(results.ind,results.full)

rownames(results.table) <- c("precision","recall","F1 score")

colnames(results.table) <- c("mean","range","mean","range")

tex.table <- xtable(results.table)

print(tex.table,file="prediction_table_cubic.tex")


##############################################################
## quartic trend


niter = 10
predict.results <- matrix(0,niter,6)

for(i in 1:niter){
  
  train.obs <- sample(1:nrow(scdata),round(0.8*nrow(scdata)))
  
  train.data <- scdata[train.obs,]
  
  #library(biglm)
  
  # MPLE
  mple.est <- glm(edgeij ~ istar2+ostar2+mutual+triangle+ edgecov.mq.t+ edgecov.same.issue.area.t+ edgecov.year.diff.t +edgecov.year.diff.square.t +  
                    nodeicov.AbsDiffMQscores+ nodeicov.NumberJusticesPro+ edgecov.year.t + nodeifactor.SameIssueArea.2+ nodeifactor.SameIssueArea.3+ 
                    nodeifactor.SameIssueArea.4+nodeifactor.SameIssueArea.5+ nodeifactor.SameIssueArea.6+ nodeifactor.SameIssueArea.7+ 
                    nodeifactor.SameIssueArea.8+nodeifactor.SameIssueArea.9+  nodeifactor.SameIssueArea.10+
                    nodeifactor.SameIssueArea.11+ nodeifactor.SameIssueArea.12+ nodeifactor.SameIssueArea.13+nodeifactor.SameIssueArea.14+ 
                    nodeofactor.SameIssueArea.2+ nodeofactor.SameIssueArea.3+ nodeofactor.SameIssueArea.4+nodeofactor.SameIssueArea.5+ 
                    nodeofactor.SameIssueArea.6+nodeofactor.SameIssueArea.7+
                    nodeofactor.SameIssueArea.8+nodeofactor.SameIssueArea.9+nodeofactor.SameIssueArea.10+ nodeofactor.SameIssueArea.11+ 
                    nodeofactor.SameIssueArea.12+ nodeofactor.SameIssueArea.13+nodeofactor.SameIssueArea.14+ nodeicov.Overruled +
                    instar2_sendertime+outstar2_sendertime+ mutual_sendertime+ triangle_sendertime+mq_sendertime +sameissuearea_sendertime+
                    yeardiff_sendertime + yeardiffsquare_sendertime+ AbsDiffMQscores_sendertime + NumberJusticesPro_sendertime + Overruled_sendertime +
                    instar2_sendertime2+outstar2_sendertime2+ mutual_sendertime2+ triangle_sendertime2+mq_sendertime2 +sameissuearea_sendertime2+
                    yeardiff_sendertime2 + yeardiffsquare_sendertime2+ AbsDiffMQscores_sendertime2 + NumberJusticesPro_sendertime2+ Overruled_sendertime2 +
                    instar2_sendertime3+outstar2_sendertime3+ mutual_sendertime3+ triangle_sendertime3+mq_sendertime3 +sameissuearea_sendertime3+
                    yeardiff_sendertime3 + yeardiffsquare_sendertime3+ AbsDiffMQscores_sendertime3 + NumberJusticesPro_sendertime3 + Overruled_sendertime3 +
                    instar2_sendertime4+outstar2_sendertime4+ mutual_sendertime4+ triangle_sendertime4+mq_sendertime4 +sameissuearea_sendertime4+
                    yeardiff_sendertime4 + yeardiffsquare_sendertime4+ AbsDiffMQscores_sendertime4 + NumberJusticesPro_sendertime4 + Overruled_sendertime4 +
                    edgecov.year.t2 + edgecov.year.t3 + edgecov.year.t4,family=binomial,data=train.data)
  summary(mple.est)
  
  save(list="mple.est",file="training_full_4.RData")
  
  
  # MPLE
  mple.est.independent <- glm(edgeij ~ edgecov.mq.t+ edgecov.same.issue.area.t+ edgecov.year.diff.t +edgecov.year.diff.square.t +  
                                nodeicov.AbsDiffMQscores+ nodeicov.NumberJusticesPro+ edgecov.year.t + nodeifactor.SameIssueArea.2+ nodeifactor.SameIssueArea.3+ 
                                nodeifactor.SameIssueArea.4+nodeifactor.SameIssueArea.5+ nodeifactor.SameIssueArea.6+ nodeifactor.SameIssueArea.7+ 
                                nodeifactor.SameIssueArea.8+nodeifactor.SameIssueArea.9+  nodeifactor.SameIssueArea.10+
                                nodeifactor.SameIssueArea.11+ nodeifactor.SameIssueArea.12+ nodeifactor.SameIssueArea.13+nodeifactor.SameIssueArea.14+ 
                                nodeofactor.SameIssueArea.2+ nodeofactor.SameIssueArea.3+ nodeofactor.SameIssueArea.4+nodeofactor.SameIssueArea.5+ 
                                nodeofactor.SameIssueArea.6+nodeofactor.SameIssueArea.7+
                                nodeofactor.SameIssueArea.8+nodeofactor.SameIssueArea.9+nodeofactor.SameIssueArea.10+ nodeofactor.SameIssueArea.11+ 
                                nodeofactor.SameIssueArea.12+ nodeofactor.SameIssueArea.13+nodeofactor.SameIssueArea.14+ nodeicov.Overruled +
                                mq_sendertime +sameissuearea_sendertime+
                                yeardiff_sendertime + yeardiffsquare_sendertime+ AbsDiffMQscores_sendertime + NumberJusticesPro_sendertime  + Overruled_sendertime +
                                mq_sendertime2 +sameissuearea_sendertime2+
                                yeardiff_sendertime2 + yeardiffsquare_sendertime2+ AbsDiffMQscores_sendertime2 + NumberJusticesPro_sendertime2+ Overruled_sendertime2 +
                                mq_sendertime3 +sameissuearea_sendertime3+
                                yeardiff_sendertime3 + yeardiffsquare_sendertime3+ AbsDiffMQscores_sendertime3 + NumberJusticesPro_sendertime3 + Overruled_sendertime3 +
                                mq_sendertime4 +sameissuearea_sendertime4+
                                yeardiff_sendertime4 + yeardiffsquare_sendertime4+ AbsDiffMQscores_sendertime4 + NumberJusticesPro_sendertime4 + Overruled_sendertime4 +
                                edgecov.year.t2 + edgecov.year.t3 + edgecov.year.t4,family=binomial,train.data)
  summary(mple.est.independent)
  
  save(list="mple.est.independent",file="training_independent_4.RData")
  
  test.data <- scdata[-train.obs,]
  
  predict.full <- c(predict(mple.est,newdata=test.data,type="response"))
  
  predict.independent <- c(predict(mple.est.independent,newdata=test.data,type="response"))
  
  
  print(names(test.data)[1:3])
  true.y <- test.data[,2]
  pred.full <- as.numeric(predict.full>0.5)
  pred.ind <- as.numeric(predict.independent>0.5)
  
  precision <- function(true.y,pred.y){
    mean(true.y[which(pred.y==1)])
  }
  
  recall <- function(true.y,pred.y){
    mean(pred.y[which(true.y==1)])
  }
  
  prec.full <- precision(true.y,pred.full)
  prec.ind <- precision(true.y,pred.ind)
  
  rec.full <- recall(true.y,pred.full)
  rec.ind <- recall(true.y,pred.ind)
  
  f1.full <- F1_Score(true.y,pred.full,pos=1)
  f1.ind  <- F1_Score(true.y,pred.ind,pos=1)
  
  predict.results[i,] <- c(prec.full,prec.ind,rec.full,rec.ind,f1.full,f1.ind)
  
  print(i)
  
}

save(list="predict.results",file="prediction.performance_4.RData")

mean.range <- function(x){
  c(round(mean(x),dig=4),paste("(",round(min(x),dig=4),", ",round(max(x),dig=4),")",sep=""))
}

results.full <- t(apply(predict.results[,c(1,3,5)],2,mean.range))
results.ind <- t(apply(predict.results[,c(2,4,6)],2,mean.range))



results.table <- cbind(results.ind,results.full)

rownames(results.table) <- c("precision","recall","F1 score")

colnames(results.table) <- c("mean","range","mean","range")

tex.table <- xtable(results.table)

print(tex.table,file="prediction_table_quartic.tex")



STOP
echo " "
echo "Job Ended at `date`"
echo " "